<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Studyfy · Documentos compartidos</title>

  <!-- Protección de acceso -->
  <script src="security.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            "studyfy-green": "#58cc02",
          },
        },
      },
    };
  </script>
</head>
<body class="min-h-screen bg-gradient-to-br from-studyfy-green via-emerald-500 to-emerald-700 px-4 py-8">

  <div class="max-w-4xl mx-auto">
    <div class="bg-white/95 backdrop-blur-xl rounded-3xl shadow-2xl px-8 py-8">
      <div class="flex items-center justify-between mb-6">
        <h1 class="text-2xl font-semibold text-gray-900">
          Documentos compartidos
        </h1>
        <a href="dashboard.html"
           class="text-xs text-gray-500 hover:text-gray-800 underline">
          Volver al panel
        </a>
      </div>

      <p class="text-sm text-gray-600 mb-4">
        Selecciona un documento para abrirlo.
      </p>

      <!-- Contenedor de lista de documentos -->
      <div id="docsContainer" class="space-y-3">
        <p id="loadingMsg" class="text-xs text-gray-500">
          Cargando documentos desde <span class="font-mono">docs.csv</span>…
        </p>
      </div>

      <p id="errorMsg" class="mt-4 text-xs text-red-500 hidden"></p>
    </div>
  </div>

  <script>
    const docsContainer = document.getElementById("docsContainer");
    const loadingMsg = document.getElementById("loadingMsg");
    const errorMsg = document.getElementById("errorMsg");

    async function loadDocs() {
      try {
        const res = await fetch("docs.csv?_=" + Date.now());
        if (!res.ok) {
          throw new Error("No se pudo cargar docs.csv");
        }

        const text = await res.text();
        const lines = text
          .split(/\r?\n/)
          .map(l => l.trim())
          .filter(l => l.length > 0);

        // Limpiar el contenedor
        docsContainer.innerHTML = "";

        if (lines.length === 0) {
          docsContainer.innerHTML = "<p class='text-xs text-gray-500'>No hay documentos registrados.</p>";
          return;
        }

        lines.forEach((line) => {
          // División simple por comas (asumiendo que no hay comas dentro de los campos)
          const parts = line.split(",");
          if (parts.length < 4) return; // línea inválida

          const nombre = parts[0].trim();
          const descripcion = parts[1].trim();
          const tipo = parts[2].trim();
          const nombreCarpeta = parts[3].trim();

          // Construir URL al archivo en la subcarpeta "Subidos"
          const href = "Subidos/" + encodeURIComponent(nombreCarpeta);

          const item = document.createElement("a");
          item.href = href;
          item.target = "_blank";
          item.className =
            "block rounded-2xl border border-gray-200 bg-gray-50 px-4 py-3 hover:bg-emerald-50 hover:border-emerald-300 transition-all";

          item.innerHTML = `
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2">
              <div>
                <p class="text-sm font-semibold text-gray-900">
                  ${nombre || "Sin título"}
                </p>
                <p class="text-xs text-gray-600 mt-1">
                  ${descripcion || "Sin descripción"}
                </p>
              </div>
              <div class="text-right">
                <span class="inline-flex items-center rounded-full bg-emerald-100 px-2.5 py-1 text-[11px] font-medium text-emerald-700">
                  ${tipo || "Documento"}
                </span>
              </div>
            </div>
          `;

          docsContainer.appendChild(item);
        });

      } catch (err) {
        console.error(err);
        if (loadingMsg) loadingMsg.remove();
        errorMsg.textContent = "Error al cargar los documentos. Revisa que docs.csv exista y tenga el formato correcto.";
        errorMsg.classList.remove("hidden");
      }
    }

    loadDocs();
  </script>
</body>
</html>
